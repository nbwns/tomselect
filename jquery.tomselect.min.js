!function(t){t.fn.tomselect=function(e,n){function s(e){e.preventDefault();var n=t(this),s=n.prev("input"),o=n.prevAll("select");if(s.is(":hidden"))a(n),s.show();else{var i=s.val();if(s.removeClass(v.invalidInputClass),i){r(o,s,n)}else s.addClass(v.invalidInputClass)}}function a(t){t.text(v.saveButtonText).removeClass(v.newButtonClass).addClass(v.saveButtonClass)}function o(t){t.text(v.newButtonText).removeClass(v.saveButtonClass).addClass(v.newButtonClass)}function i(t,e,n,s){e.attr("disabled",s),t.attr("disabled",s),n.attr("disabled",s)}function l(t,e){var n=e.val(),s="<option value='"+n+"'>"+n+"</option>";return t.append(s),n}function u(t,e,n){t.find("option:selected").removeAttr("selected"),t.find("option:contains("+e.val()+")").prop("selected",!0),e.val("").hide(),o(n),i(t,e,n,!1)}function p(e,n,s){if(c.resetSelect&&(this.empty(),c.addEmptyOption)){var a="<option value=''></option>";this.append(a)}if("array"===t.type(e))t.each(e,function(t,e){d(this,e)}.bind(this));else if("object"===t.type(e))d(this,e);else{if("string"!==t.type(e))throw"Could not parse the returned data "+e;var a="<option value='"+e+"'>"+e+"</option>";this.append(a)}c.success(e,n,s)}function d(t,e){if(!c.key||!c.text)throw"Please provide values for the 'key' and 'text' properties";var n="<option value='"+e[c.key]+"'>"+e[c.text]+"</option>";t.append(n)}function r(e,n,s){var a=n.val();i(e,n,s,!0),c?c.saved?(c.saved(l(e,n)),u(e,n,s)):c.endpoint&&t.ajax({url:c.endpoint,data:{value:a},type:c.method,dataType:"JSON"}).done(p.bind(e)).done(u.bind(null,e,n,s)).fail(function(t,a,o){i(e,n,s,!1),c.error(t,a,o)}):(l(e,n),u(e,n,s))}e=e||{};var v={newButtonClass:e.newButtonClass||"",saveButtonClass:e.saveButtonClass||"",newButtonText:e.newButtonText||"New",saveButtonText:e.saveButtonText||"Save",inputClass:e.inputClass||"",groupClass:e.groupClass||"tomselect-group",invalidInputClass:e.invalidInputClass||"tomselect-invalid",selectNewOption:e.selectNewOption||!0},c=null;if(n)if(c={},"function"===t.type(n))c.saved=n;else if("object"===t.type(n)&&(c={endpoint:n.endpoint||null,method:n.method||"POST",key:n.key||null,text:n.text||null,resetSelect:n.resetSelect||!0,success:n.success||function(){},error:n.error||function(){},addEmptyOption:n.addEmptyOption||!0},!c.endpoint))throw"You must provide an endpoint";var f=this;f.each(function(){if(!t(this).is("select"))throw".tomselect must be called on <select> elements";$group=t("<div></div>").addClass(v.groupClass),t(this).wrap($group),$group=t(this).parent();var e=t("<input type='text'/>").addClass(v.inputClass).hide();$group.append(e);var n=t("<button></button>").addClass(v.newButtonClass).text(v.newButtonText);n.click(s),$group.append(n)})}}(jQuery);